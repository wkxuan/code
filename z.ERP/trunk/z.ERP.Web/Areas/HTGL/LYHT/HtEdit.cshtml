@using z.ERP.Web.Areas.Share.Render
@using z.ERP.Entities.Enum
@using z.ERP.Web.Areas.Layout.Edit;
@inherits EditViewBase<string>

@section head{}
@section detailParamFooter{
    <row>
        <i-col span="2" class="RowTitle">
            启动人:
        </i-col>
        <i-col span="4" class="Rowline">
            <label>{{dataParam.INITINATE_NAME}}</label>
        </i-col>
        <i-col span="2" class="RowTitle">
            启动时间:
        </i-col>
        <i-col span="4" class="Rowline">
            <label>{{dataParam.INITINATE_TIME}}</label>
        </i-col>
        <i-col span="2" class="RowTitle">
            终止人:
        </i-col>
        <i-col span="4" class="Rowline">
            <label>{{dataParam.TERMINATE_NAME}}</label>
        </i-col>
        <i-col span="2" class="RowTitle">
            终止时间:
        </i-col>
        <i-col span="4" class="Rowline">
            <label>{{dataParam.TERMINATE_TIME}}</label>
        </i-col>
    </row>
}
@section baseParam{
    <row>
        <i-col span="2" class="RowTitle">
            <span class="mustElement">*</span>
            商户
        </i-col>
        <i-col span="6" class="RowText">
            <i-input readonly v-bind:icon="(!disabled||dataParam.CONTRACT_OLD)? '':'md-search'"
                     v-model="dataParam.MERNAME" v-on:on-click="srchMerchant"
                     v-bind:disabled="(!disabled||dataParam.CONTRACT_OLD)? true:false" />
        </i-col>
        <i-col span="2" class="RowTitle">
            纸质编号
        </i-col>
        <i-col span="6" class="RowText">
            <i-input v-model="dataParam.CONTRACTID_PAPER" v-bind:disabled="!disabled" />
        </i-col>
        <i-col span="2" class="RowTitle">
            核算方式
        </i-col>
        <i-col span="6" class="RowText">
            <i-input v-model="dataParam.STYLEMC" disabled />
        </i-col>
    </row>
    <row>
        <i-col span="2" class="RowTitle">
            <span class="mustElement">*</span>
            开始日期
        </i-col>
        <i-col span="6" class="RowText">
            <date-picker type="date" v-bind:value="dataParam.CONT_START" v-on:on-change="contStartChange"
                         v-bind:disabled="(!disabled||dataParam.CONTRACT_OLD)? true:false"></date-picker>
        </i-col>
        <i-col span="2" class="RowTitle">
            <span class="mustElement">*</span>
            结束日期
        </i-col>
        <i-col span="6" class="RowText">
            <date-picker type="date" v-bind:value="dataParam.CONT_END" v-on:on-change="contEndChange"
                         v-bind:disabled="!disabled"></date-picker>
        </i-col>
        <i-col span="2" class="RowTitle">
            原合同号
        </i-col>
        <i-col span="6" class="RowText">
            <i-input readonly v-model="dataParam.CONTRACT_OLD" v-bind:disabled="!disabled" />
        </i-col>
    </row>
    <row>
        <i-col span="2" class="RowTitle">
            <span class="mustElement">*</span>
            招商部门
        </i-col>
        <i-col span="6" class="RowText">
            <i-select v-model="dataParam.ORGID" transfer
                      v-bind:disabled="(!disabled||dataParam.CONTRACT_OLD)? true:false" v-on:on-open-change="orgOpenChange">
                <i-option v-for="item in screenParam.orgList" v-bind:value="item.value"
                          v-bind:key="item.value">{{ item.label }}</i-option>
            </i-select>
        </i-col>
        <i-col span="2" class="RowTitle">
            合同员
        </i-col>
        <i-col span="6" class="RowText">
            <i-input readonly v-bind:icon="disabled? 'md-search':''"
                     v-model="dataParam.SIGNER_NAME" v-on:on-click="srchSigner" v-bind:disabled="!disabled" />
        </i-col>
        <i-col span="2" class="RowTitle">
            建筑面积
        </i-col>
        <i-col span="6" class="RowText">
            <i-input readonly v-model="dataParam.AREA_BUILD" v-bind:disabled="!disabled" />
        </i-col>
    </row>
    <row>
        <i-col span="2" class="RowTitle">
            装修期起
        </i-col>
        <i-col span="6" class="RowText">
            @{
                RenderControl(new DateBoxRender()
                {
                    vModel = "dataParam.FIT_BEGIN",
                });
            }
        </i-col>
        <i-col span="2" class="RowTitle">
            装修期至
        </i-col>
        <i-col span="6" class="RowText">
            @{
                RenderControl(new DateBoxRender()
                {
                    vModel = "dataParam.FIT_END",
                });
            }
        </i-col>
        <i-col span="2" class="RowTitle">
            租用面积
        </i-col>
        <i-col span="6" class="RowText">
            <i-input readonly v-model="dataParam.AREAR" v-bind:disabled="!disabled" />
        </i-col>
    </row>
    <row>
        <i-col span="2" class="RowTitle">
            销售额标记
        </i-col>
        <i-col span="6" class="RowText">
            @{
                RenderControl(new EnumDropDownListRender<销售额标记>()
                {
                    vModel = "dataParam.TAB_FLAG"
                });
            }
        </i-col>
        <i-col span="2" class="RowTitle">
            进项税率
        </i-col>
        <i-col span="6" class="RowText">
            <input-number v-bind:max="1" v-bind:min="0" v-bind:step="0.01" v-model="dataParam.JXSL" v-bind:disabled="!disabled">
            </input-number>
        </i-col>
        <i-col span="2" class="RowTitle">
            销项税率
        </i-col>
        <i-col span="6" class="RowText">
            <input-number v-bind:max="1" v-bind:min="0" v-bind:step="0.01" v-model="dataParam.XXSL" v-bind:disabled="!disabled">
            </input-number>
        </i-col>
    </row>
    <row>
        <i-col span="2" class="RowTitle">提前返款日</i-col>
        <i-col span="6" class="RowText">
            <i-select v-model="screenParam.TQFKR" multiple v-bind:disabled="!disabled">
                <i-option v-for="(i,k) in screenParam.fkrList" v-bind:value="i.value"
                          v-bind:key="k">{{ i.label }}</i-option>
            </i-select>
        </i-col>
        <i-col span="2" class="RowTitle">
            起始日清算
        </i-col>
        <i-col span="6" class="RowText">
            @{
                RenderControl(new EnumDropDownListRender<起始日清算>()
                {
                    vModel = "dataParam.QS_START"
                });
            }
        </i-col>
        <i-col span="2" class="RowTitle" v-if="dataParam.CONTRACT_OLD">
            <span class="mustElement">*</span>
            变更启动日期
        </i-col>
        <i-col span="6" class="RowText" v-if="dataParam.CONTRACT_OLD">
            @{
                RenderControl(new DateBoxRender()
                {
                    vModel = "dataParam.JHRQ",
                });
            }
        </i-col>
    </row>
    <row>
        <i-col span="2" class="RowTitle">
            其他条款
        </i-col>
        <i-col span="22" class="RowText">
            @{
                RenderControl(new TextBoxRender()
                {
                    vModel = "dataParam.DESCRIPTION",
                    type = "textarea",
                    rows = "3"
                });
            }
        </i-col>
    </row>
    <row>
        <i-col span="12">
            <Card v-bind:padding=0>
                <p slot="title"><span class="mustElement">*</span>品牌</p>
                <div slot="extra">
                    <div class="tableBtnDiv" v-if="disabled">
                        <i-button type="primary" v-on:click="srchBrand">选择</i-button>
                        <i-button type="error" v-on:click="delBrand">删除</i-button>
                    </div>
                </div>
                <yx-table v-bind:columns="screenParam.colDefPP" selection=true
                          v-bind:data="dataParam.CONTRACT_BRAND" v-bind:disabled="!disabled" ref="refBrand">
                </yx-table>
            </Card>
        </i-col>
        <i-col span="12">
            <Card v-bind:padding=0>
                <p slot="title"><span class="mustElement">*</span>资产</p>
                <div slot="extra">
                    <div class="tableBtnDiv" v-if="disabled">
                        <i-button type="primary" v-on:click="srchShop">选择</i-button>
                        <i-button type="primary" v-on:click="addRowShop">添加一行</i-button>
                        <i-button type="error" v-on:click="delShop">删除</i-button>
                    </div>
                </div>
                <yx-table v-bind:columns="screenParam.colDefSHOP" selection=true
                          v-bind:data="dataParam.CONTRACT_SHOP" v-bind:disabled="!disabled" ref="refShop">
                </yx-table>
            </Card>
        </i-col>
    </row>
    <row>
        <i-col span="24">
            <Card v-bind:padding=0>
                <p slot="title"><span class="mustElement">*</span>扣率组</p>
                <div slot="extra">
                    <div v-if="disabled">
                        <i-button type="primary" v-on:click="addColGroup">添加一行</i-button>
                        <i-button type="error" v-on:click="delColGroup">删除</i-button>
                    </div>
                </div>
                <yx-table v-bind:columns="screenParam.colGroup"  selection=true
                          v-bind:data="dataParam.CONTRACT_GROUP" v-bind:disabled="!disabled" ref="refGroup">
                </yx-table>
            </Card>
        </i-col>
    </row>
}
@section detailParam{
    <Tabs value="name1">
        <tab-pane label="保底与目标" name="name1">
            <row>
                <i-col span="24">
                    <div class="tableBtnDiv" v-if="disabled">
                        <i-button type="primary" v-on:click="addColRent">添加一行</i-button>
                        <i-button type="error" v-on:click="delColRent">删除</i-button>
                        <i-button type="primary" v-bind:loading="screenParam.yearLoading" v-on:click="operPeriod">
                            <span v-if="!screenParam.yearLoading">按年度分解</span>
                            <span v-else>正在分解</span>
                        </i-button>
                        <i-button type="primary" v-bind:loading="screenParam.monthLoading" v-on:click="decompose">
                            <span v-if="!screenParam.monthLoading">按月度分解</span>
                            <span v-else>正在分解</span>
                        </i-button>
                    </div>
                </i-col>
                <i-col span="24">
                    <yx-table v-bind:columns="screenParam.colDefRENT" v-bind:height="200" selection=true
                              v-bind:data="dataParam.CONTRACT_RENT" v-bind:disabled="!disabled" ref="refRent">
                    </yx-table>
                </i-col>
            </row>
            <row v-if="screenParam.targetInfo.length">
                <i-col span="24">
                    <Card v-bind:padding=0>
                        <p slot="title">多目标信息</p>
                        <Tabs type="card" v-bind:value="screenParam.targetValue">
                            <tab-pane v-bind:label="'时间段'+i.INX" v-for="(i,k) in screenParam.targetInfo" v-bind:key="k" v-bind:name="i.INX">
                                <row v-for="(j,h) in i.targetData" v-bind:key="h">
                                    <i-col span="2" class="RowTitle">
                                        目标{{j.TARGETID}}
                                    </i-col>
                                    <i-col span="3" class="RowTitle">
                                        起始金额(包含)
                                    </i-col>
                                    <i-col span="4" class="RowText">
                                        <i-input type="number" v-model="j.SALES_START" v-bind:disabled="!disabled" v-on:on-change="salesStartChange(i.INX,j.TARGETID)" />
                                    </i-col>
                                    <i-col span="3" class="RowTitle">
                                        结束金额(不包含)
                                    </i-col>
                                    <i-col span="4" class="RowText">
                                        <i-input type="number" v-model="j.SALES_END" v-bind:disabled="!disabled"
                                                 v-on:on-change="salesEndChange(i.INX,j.TARGETID)" />
                                    </i-col>
                                    <i-col span="2" class="RowTitle">
                                        目标扣率(%)
                                    </i-col>
                                    <i-col span="4" class="RowText">
                                        <i-input type="number" v-model="j.JSKL" v-bind:disabled="!disabled" />
                                    </i-col>
                                    <i-col span="2" class="RowTitle" v-if="disabled&&(i.targetData.length-1==h)">
                                        <i-button type="error" v-on:click="delTarget(i.INX)">删除</i-button>
                                    </i-col>
                                </row>
                                <row v-if="disabled">
                                    <i-col span="24" style="text-align:center;">
                                        <i-button type="primary" v-on:click="addTarget(i.INX)">添加</i-button>
                                    </i-col>
                                </row>
                                <row>
                                    <i-col span="24">
                                        <Card v-bind:padding=0>
                                            <p slot="title"><span class="mustElement">*</span>月度分解信息</p>
                                            <yx-table v-bind:columns="screenParam.colDefRENTITEM" v-bind:height="200"
                                                      v-bind:data="i.rentItemData" v-bind:disabled="!disabled">
                                            </yx-table>
                                        </Card>
                                    </i-col>
                                </row>
                            </tab-pane>
                        </Tabs>
                    </Card>
                </i-col>
            </row>
        </tab-pane>
        <tab-pane label="费用项目" name="name2">
            <row>
                <i-col span="24">
                    <div class="tableBtnDiv" v-if="disabled">
                        <i-button type="primary" v-on:click="srchFeeSubject">选择</i-button>
                        <i-button type="primary" v-on:click="addRowFeeSubject">添加一行</i-button>
                        <i-button type="error" v-on:click="delFeeSubject">删除</i-button>
                    </div>
                </i-col>
                <i-col span="24">
                    <yx-table v-bind:columns="screenParam.colDefCOST" v-bind:height="300" selection=true
                              v-bind:data="dataParam.CONTRACT_COST" v-bind:disabled="!disabled" ref="refCost">
                    </yx-table>
                </i-col>
            </row>
        </tab-pane>
        <tab-pane label="收款方式" name="name3">
            <i-col span="24">
                <div class="tableBtnDiv" v-if="disabled">
                    <i-button type="primary" v-on:click="srchPay">选择</i-button>
                    <i-button type="primary" v-on:click="srchPayCost">选择费用项目</i-button>
                    <i-button type="error" v-on:click="delPay">删除</i-button>
                </div>
            </i-col>
            <i-col span="24">
                <yx-table v-bind:columns="screenParam.colDefPAY" v-bind:height="300" selection=true
                          v-bind:data="dataParam.CONTRACT_PAY" v-bind:disabled="!disabled" ref="refPay">
                </yx-table>
            </i-col>
        </tab-pane>
        <tab-pane label="商户付款信息" name="name4">
            <row>
                <i-col span="3" class="RowTitle">
                    付款信息编码
                </i-col>
                <i-col span="5" class="RowText">
                    <i-input readonly v-bind:icon="disabled? 'md-search':''"
                             v-model="dataParam.PAYMENTID" v-on:on-click="srchPayMent" v-bind:disabled="!disabled" />
                </i-col>
                <i-col span="3" class="RowTitle">
                    <i-button type="error" v-on:click="clearPayMent" v-if="disabled">清空付款信息</i-button>
                </i-col>
            </row>
            <row>
                <i-col span="3" class="RowTitle">
                    银行卡号
                </i-col>
                <i-col span="9" class="RowText">
                    <i-input readonly v-model="screenParam.CARDNO" v-bind:disabled="!disabled" />
                </i-col>
                <i-col span="3" class="RowTitle">
                    银行名称
                </i-col>
                <i-col span="9" class="RowText">
                    <i-input readonly v-model="screenParam.BANKNAME" v-bind:disabled="!disabled" />
                </i-col>
            </row>
            <row>
                <i-col span="3" class="RowTitle">
                    开户人
                </i-col>
                <i-col span="9" class="RowText">
                    <i-input readonly v-model="screenParam.HOLDERNAME" v-bind:disabled="!disabled" />
                </i-col>
                <i-col span="3" class="RowTitle">
                    身份证号
                </i-col>
                <i-col span="9" class="RowText">
                    <i-input readonly v-model="screenParam.IDCARD" v-bind:disabled="!disabled" />
                </i-col>
            </row>
        </tab-pane>
    </Tabs>
}
